<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Veterinaria a Domicilio - Agenda tu Visita</title>
    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@700&family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- EmailJS para env√≠o autom√°tico de emails -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <style>
        :root {
            --primary: #4a7c59;
            --primary-dark: #3a5f45;
            --secondary: #f4a261;
            --accent: #e76f51;
            --bg-light: #faf8f3;
            --bg-cream: #f5efe6;
            --text-dark: #2d3436;
            --text-light: #636e72;
            --shadow: rgba(74, 124, 89, 0.15);
            --shadow-strong: rgba(74, 124, 89, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Quicksand', sans-serif;
            background: linear-gradient(135deg, var(--bg-light) 0%, var(--bg-cream) 100%);
            color: var(--text-dark);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Decorative background elements */
        body::before {
            content: '';
            position: fixed;
            top: -50%;
            right: -10%;
            width: 500px;
            height: 500px;
            background: radial-gradient(circle, rgba(244, 162, 97, 0.1) 0%, transparent 70%);
            border-radius: 50%;
            pointer-events: none;
            animation: float 20s ease-in-out infinite;
        }

        body::after {
            content: '';
            position: fixed;
            bottom: -30%;
            left: -5%;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(74, 124, 89, 0.08) 0%, transparent 70%);
            border-radius: 50%;
            pointer-events: none;
            animation: float 15s ease-in-out infinite reverse;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(30px, -30px) rotate(120deg); }
            66% { transform: translate(-20px, 20px) rotate(240deg); }
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        header {
            text-align: center;
            padding: 40px 20px;
            animation: slideDown 0.8s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            font-family: 'Caveat', cursive;
            font-size: 3.5rem;
            color: var(--primary);
            margin-bottom: 10px;
            text-shadow: 2px 2px 0px rgba(244, 162, 97, 0.3);
            line-height: 1.2;
        }

        .subtitle {
            font-size: 1.2rem;
            color: var(--text-light);
            font-weight: 500;
        }

        .paw-icon {
            display: inline-block;
            animation: bounce 2s ease-in-out infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .instagram-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%);
            color: white;
            text-decoration: none;
            padding: 12px 24px;
            border-radius: 30px;
            font-weight: 600;
            margin-top: 15px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 15px rgba(188, 24, 136, 0.3);
        }

        .instagram-link:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(188, 24, 136, 0.4);
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            background: white;
            padding: 8px;
            border-radius: 50px;
            box-shadow: 0 4px 20px var(--shadow);
            animation: slideUp 0.8s ease-out 0.2s both;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .tab {
            flex: 1;
            padding: 15px 20px;
            border: none;
            background: transparent;
            border-radius: 40px;
            cursor: pointer;
            font-family: 'Quicksand', sans-serif;
            font-weight: 600;
            font-size: 1rem;
            color: var(--text-light);
            transition: all 0.3s ease;
        }

        .tab.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 15px var(--shadow-strong);
            transform: scale(1.02);
        }

        .tab:hover:not(.active) {
            background: var(--bg-cream);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 35px;
            box-shadow: 0 8px 30px var(--shadow);
            margin-bottom: 25px;
            border: 3px solid transparent;
            background-clip: padding-box;
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px var(--shadow-strong);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 50%, var(--accent) 100%);
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary-dark);
            font-size: 1rem;
        }

        input, select, textarea {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-family: 'Quicksand', sans-serif;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: var(--bg-light);
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(74, 124, 89, 0.1);
            transform: translateY(-2px);
        }

        .time-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .time-slot {
            padding: 12px;
            background: var(--bg-cream);
            border: 2px solid var(--primary);
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
        }

        .time-slot:hover {
            background: var(--primary);
            color: white;
            transform: scale(1.05);
        }

        .time-slot.selected {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 15px var(--shadow-strong);
        }

        .time-slot.unavailable {
            background: #f0f0f0;
            border-color: #ccc;
            color: #999;
            cursor: not-allowed;
            opacity: 0.5;
        }

        .time-slot.unavailable:hover {
            transform: none;
            background: #f0f0f0;
            color: #999;
        }

        button.primary {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-family: 'Quicksand', sans-serif;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px var(--shadow);
            position: relative;
            overflow: hidden;
        }

        button.primary::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        button.primary:hover::before {
            width: 300px;
            height: 300px;
        }

        button.primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 25px var(--shadow-strong);
        }

        button.primary:active {
            transform: translateY(-1px);
        }

        button.secondary {
            padding: 10px 20px;
            background: white;
            color: var(--primary);
            border: 2px solid var(--primary);
            border-radius: 10px;
            font-family: 'Quicksand', sans-serif;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        button.secondary:hover {
            background: var(--primary);
            color: white;
        }

        .success-message {
            background: linear-gradient(135deg, #a8e6cf 0%, #7fc8a9 100%);
            color: #2d5f4d;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            text-align: center;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(127, 200, 169, 0.3);
            animation: slideDown 0.5s ease-out;
        }

        .appointments-list {
            margin-top: 20px;
        }

        .appointment-card {
            background: var(--bg-cream);
            border-left: 4px solid var(--primary);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .appointment-card:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 15px var(--shadow);
        }

        .appointment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .appointment-name {
            font-weight: 700;
            color: var(--primary-dark);
            font-size: 1.1rem;
        }

        .appointment-info {
            color: var(--text-light);
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .admin-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .schedule-item {
            background: var(--bg-cream);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 3px solid var(--secondary);
        }

        .delete-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .delete-btn:hover {
            background: #d35f45;
            transform: scale(1.05);
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2.5rem;
            }

            .tabs {
                flex-direction: column;
                border-radius: 20px;
            }

            .tab {
                border-radius: 15px;
            }

            .admin-controls {
                grid-template-columns: 1fr;
            }

            .time-grid {
                grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
            }

            .appointment-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            background: var(--secondary);
            color: white;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .badge.pendiente {
            background: var(--secondary);
        }

        .badge.realizada {
            background: #4caf50;
        }

        .badge.cancelada {
            background: #f44336;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .btn-action {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            font-family: 'Quicksand', sans-serif;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-complete {
            background: #4caf50;
            color: white;
        }

        .btn-complete:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .btn-cancel {
            background: #f44336;
            color: white;
        }

        .btn-cancel:hover {
            background: #da190b;
            transform: translateY(-2px);
        }

        .appointment-card.realizada {
            opacity: 0.7;
            border-left-color: #4caf50;
        }

        .appointment-card.cancelada {
            opacity: 0.6;
            border-left-color: #f44336;
        }

        .search-box {
            background: linear-gradient(135deg, var(--bg-cream) 0%, white 100%);
            border: 2px solid var(--primary);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            text-align: center;
        }

        .search-box h3 {
            color: var(--primary);
            margin-bottom: 15px;
        }

        .search-input {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .search-input input {
            flex: 1;
            min-width: 200px;
            max-width: 300px;
        }

        .cancellation-code {
            display: inline-block;
            background: var(--bg-cream);
            padding: 5px 12px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-weight: 700;
            color: var(--primary);
            border: 2px dashed var(--primary);
            margin: 5px 0;
        }

        .info-box {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            color: #856404;
        }

        .info-box strong {
            color: #856404;
        }

        /* Modal de contrase√±a */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease-out;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: scaleIn 0.3s ease-out;
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .modal h3 {
            color: var(--primary);
            margin-bottom: 10px;
            font-family: 'Caveat', cursive;
            font-size: 2rem;
        }

        .modal p {
            color: var(--text-light);
            margin-bottom: 20px;
        }

        .modal input {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-family: 'Quicksand', sans-serif;
            font-size: 1rem;
            margin-bottom: 15px;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
        }

        .modal-buttons button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-family: 'Quicksand', sans-serif;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal-buttons .btn-cancel {
            background: #f0f0f0;
            color: var(--text-dark);
        }

        .modal-buttons .btn-confirm {
            background: var(--primary);
            color: white;
        }

        .modal-buttons button:hover {
            transform: translateY(-2px);
        }

        .lock-icon {
            font-size: 1.2rem;
        }

        /* Estilos para servicios */
        .service-item {
            background: linear-gradient(135deg, #a8e6cf 0%, #7fc8a9 100%);
            border-radius: 50px;
            padding: 20px 30px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
            animation: slideIn 0.5s ease-out;
            box-shadow: 0 4px 15px rgba(127, 200, 169, 0.3);
        }

        .service-item:hover {
            transform: translateX(10px);
            box-shadow: 0 6px 20px rgba(127, 200, 169, 0.5);
        }

        .service-content {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .service-icon {
            font-size: 2.5rem;
        }

        .service-name {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-dark);
        }

        .service-price {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-dark);
        }

        .services-header {
            text-align: center;
            background: linear-gradient(135deg, var(--bg-cream) 0%, white 100%);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            border: 3px solid var(--secondary);
        }

        .services-header h2 {
            font-family: 'Caveat', cursive;
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .whatsapp-footer {
            background: linear-gradient(135deg, #7fc8a9 0%, #5fb88f 100%);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            margin-top: 30px;
            color: white;
            box-shadow: 0 6px 20px rgba(127, 200, 169, 0.4);
        }

        .whatsapp-footer h3 {
            font-size: 1.3rem;
            margin-bottom: 10px;
        }

        .whatsapp-footer p {
            font-size: 1rem;
            margin: 5px 0;
        }

        .whatsapp-footer strong {
            font-size: 1.3rem;
        }

        /* D√≠as de la semana */
        .days-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .day-checkbox {
            display: none;
        }

        .day-label {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px 10px;
            background: var(--bg-cream);
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            text-align: center;
        }

        .day-label:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
        }

        .day-checkbox:checked + .day-label {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            box-shadow: 0 4px 15px var(--shadow-strong);
        }

        .day-name {
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .day-icon {
            font-size: 1.5rem;
        }

        /* Subtabs */
        .subtab {
            background: none;
            border: none;
            padding: 15px 25px;
            font-size: 16px;
            font-weight: 600;
            color: var(--text-light);
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .subtab:hover {
            color: var(--primary);
        }

        .subtab.active {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
        }

        .subtab-content {
            display: none;
        }

        .subtab-content.active {
            display: block;
        }

    </style>
</head>
<body>
    <div class="container">
        <header>
            <div style="display: flex; align-items: center; justify-content: center; gap: 20px; margin-bottom: 20px; flex-wrap: wrap;">
                <img id="logoManadaPatitas" src="" alt="Manada Patitas" style="height: 80px; animation: bounce 2s ease-in-out infinite;">
                <div style="text-align: left;">
                    <h1 style="margin: 0;">Manada Patitas</h1>
                    <p style="font-size: 1.1rem; color: var(--secondary); font-weight: 600; margin: 5px 0 0 0;">Veterinaria a Domicilio</p>
                </div>
            </div>
            <p class="subtitle">Cuidado profesional para tu mascota en la comodidad de tu hogar</p>
            <a href="#" id="instagramLink" class="instagram-link" target="_blank">
                üì± S√≠guenos en Instagram
            </a>
        </header>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('servicios')">üí∞ Servicios</button>
            <button class="tab" onclick="switchTab('agendar')">üìÖ Agendar</button>
            <button class="tab" onclick="switchTab('citas')">üìã Mis Citas</button>

            <button class="tab" onclick="switchTab('admin')"><span class="lock-icon">üîí</span> Acceso Veterinario</button>
        </div>

        <!-- TAB: SERVICIOS Y PRECIOS -->
        <div id="servicios" class="tab-content active">
            <div class="services-header">
                <h2>Lista de precios:</h2>
                <p style="color: var(--text-light); font-weight: 600;">Nuestros servicios veterinarios a domicilio</p>
            </div>

            <div class="service-item">
                <div class="service-content">
                    <div class="service-icon">ü©∫</div>
                    <div class="service-name">Consultas generales</div>
                </div>
                <div class="service-price">$20.000</div>
            </div>

            <div class="service-item">
                <div class="service-content">
                    <div class="service-icon">üíâ</div>
                    <div class="service-name">Inyectables en consulta</div>
                </div>
                <div class="service-price">$5.000</div>
            </div>

            <div class="service-item">
                <div class="service-content">
                    <div class="service-icon">üíâ</div>
                    <div class="service-name">Consulta + Vacunaci√≥n Perros</div>
                </div>
                <div class="service-price">$27.000</div>
            </div>

            <div class="service-item">
                <div class="service-content">
                    <div class="service-icon">üíâ</div>
                    <div class="service-name">Consulta + Vacunaci√≥n Gatos</div>
                </div>
                <div class="service-price">$32.000</div>
            </div>

            <div class="service-item">
                <div class="service-content">
                    <div class="service-icon">ü©π</div>
                    <div class="service-name">Curaciones</div>
                </div>
                <div class="service-price">$15.000</div>
            </div>

            <div class="service-item">
                <div class="service-content">
                    <div class="service-icon">‚ù§Ô∏è</div>
                    <div class="service-name">Despedidas con amor</div>
                </div>
                <div class="service-price">$60.000</div>
            </div>

            <div class="whatsapp-footer">
                <h3>¬øTu peludito necesita un chequeo?</h3>
                <p>¬°Evita el estr√©s de los traslados y las salas de espera!</p>
                <p style="margin-top: 15px;">üì± Agenda tu cita al WhatsApp:</p>
                <p><strong id="whatsappDisplay">+(56) 9 9540 9035</strong></p>
                <p style="margin-top: 10px;">üìß O escr√≠benos al email:</p>
  <p><strong id="emailDisplay"><a href="/cdn-cgi/l/email-protection#bed3dfd0dfdadfcedfcad7cadfcdc8dbcadbccd7d0dfccd7dffed9d3dfd7d290ddd1d3"><span class="__cf_email__" data-cfemail="abc6cac5cacfcadbcadfc2dfcad8ddcedfced9c2c5cad9c2caebccc6cac2c785c8c4c6">[email&#160;protected]</span></a></strong></p>            </div>

            <button class="primary" style="margin-top: 20px;" onclick="switchTab('agendar')">
                üìÖ Agendar mi visita ahora
            </button>
        </div>

        <!-- TAB: AGENDAR VISITA -->
        <div id="agendar" class="tab-content">
            <div class="card">
                <h2 style="margin-bottom: 25px; color: var(--primary); font-family: 'Caveat', cursive; font-size: 2rem;">Agenda tu Visita</h2>
                
                <form id="appointmentForm">
                    <div class="form-group">
                        <label>üë§ Nombre del due√±o/a</label>
                        <input type="text" id="ownerName" required placeholder="Tu nombre completo">
                    </div>

                    <div class="form-group">
                        <label>üêï Nombre de la mascota</label>
                        <input type="text" id="petName" required placeholder="Nombre de tu mascota">
                    </div>

                    <div class="form-group">
                        <label>üìû Tel√©fono de contacto</label>
                        <input type="tel" id="phone" required placeholder="+56 9 1234 5678">
                    </div>

                    <div class="form-group">
                        <label>üìß Email (Opcional - para confirmaci√≥n autom√°tica)</label>
                        <input type="email" id="clientEmail" placeholder="tu@email.com">
                        <small style="color: var(--text-light); font-size: 0.85rem;">Si ingresas tu email, recibir√°s confirmaci√≥n autom√°tica instant√°nea</small>
                    </div>

                    <div class="form-group">
                        <label>üìç Comuna</label>
                        <select id="comuna" required>
                            <option value="">Selecciona tu comuna</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>üè† Direcci√≥n completa</label>
                        <input type="text" id="address" required placeholder="Ej: Av. Providencia 1234, Depto 501">
                        <small style="color: var(--text-light); font-size: 0.85rem;">Calle, n√∫mero, depto/casa (si aplica)</small>
                    </div>

                    <div class="form-group">
                        <label>üìÖ Fecha de la visita</label>
                        <p id="availableDaysInfo" style="font-size: 0.9rem; color: var(--text-light); margin-bottom: 8px;"></p>
                        <input type="date" id="visitDate" required>
                    </div>

                    <div class="form-group">
                        <label>üïê Horario disponible</label>
                        <div id="timeSlots" class="time-grid"></div>
                    </div>

                    <div class="form-group">
                        <label>üí¨ Motivo de la consulta</label>
                        <textarea id="reason" rows="4" placeholder="Describe brevemente el motivo de la visita veterinaria"></textarea>
                    </div>

                    <button type="submit" class="primary">‚ú® Solicitar Visita</button>
                </form>
            </div>
        </div>

        <!-- TAB: MIS CITAS -->
        <div id="citas" class="tab-content">
            <div class="card">
                <h2 style="margin-bottom: 25px; color: var(--primary); font-family: 'Caveat', cursive; font-size: 2rem;">Mis Citas Agendadas</h2>
                
                <div id="accessCodePrompt">
                    <p style="text-align: center; color: var(--text-light); margin-bottom: 20px;">
                        Para ver tus citas, ingresa el c√≥digo que recibiste al agendar
                    </p>
                    <div style="display: flex; gap: 10px; max-width: 400px; margin: 0 auto;">
                        <input type="text" id="clientAccessCodeInput" placeholder="Ej: ABC123" 
                               style="text-transform: uppercase; letter-spacing: 2px; font-size: 1.2rem; font-weight: 700; text-align: center;"
                               maxlength="6"
                               onkeypress="if(event.key === 'Enter') verifyAccessCode()">
                        <button class="secondary" onclick="verifyAccessCode()">üîç Ver Mis Citas</button>
                    </div>
                    <p style="text-align: center; color: var(--text-light); margin-top: 15px; font-size: 0.9rem;">
                        üí° El c√≥digo te lleg√≥ por WhatsApp y/o Email al agendar<br>
                        üìû ¬øNo lo tienes? Cont√°ctanos al WhatsApp
                    </p>
                </div>
                
                <div id="appointmentsList" style="display: none;"></div>
                <button id="changeCodeBtn" class="secondary" onclick="resetAccessCode()" style="display: none; margin-top: 20px;">
                    üîÑ Ver otras citas (cambiar c√≥digo)
                </button>
            </div>
        </div>

        <!-- TAB: ADMIN/CONFIGURACI√ìN -->

            <div style="text-align: center; margin-top: 30px;">
                <button class="secondary" onclick="logout()">üö™ Cerrar Sesi√≥n Admin</button>
            </div>
        </div>

        <div id="admin" class="tab-content">
            <h2 style="margin-bottom: 20px;">ü©∫ Acceso Veterinario</h2>
            
            <!-- Subtabs -->
            <div style="display: flex; gap: 10px; margin-bottom: 30px; border-bottom: 2px solid var(--primary);">
                <button id="subtabConfig" class="subtab active" onclick="switchSubtab('config')">
                    ‚öôÔ∏è Configuraci√≥n Sistema
                </button>
                <button id="subtabVet" class="subtab" onclick="switchSubtab('veterinario')">
                    üìã Gesti√≥n Veterinario
                </button>
            </div>

            <!-- Contenido Subtab: Config -->
            <div id="subtab-config" class="subtab-content active">
            <div class="card">
                <h2 style="margin-bottom: 25px; color: var(--primary); font-family: 'Caveat', cursive; font-size: 2rem;">Configuraci√≥n del Sistema</h2>
                
                <div class="form-group">
                    <label>üîó URL de Instagram</label>
                    <input type="url" id="instagramUrl" placeholder="https://instagram.com/tuperfil">
                    <button class="primary" style="margin-top: 10px;" onclick="saveInstagram()">Guardar Instagram</button>
                </div>

                <hr style="margin: 30px 0; border: none; border-top: 2px dashed #e0e0e0;">

                <h3 style="margin-bottom: 15px; color: var(--primary-dark);">üì≤ Notificaciones de Agendamientos</h3>
                <p style="color: var(--text-light); margin-bottom: 20px; font-size: 0.95rem;">
                    Configura tu WhatsApp y/o email para recibir autom√°ticamente los agendamientos de tus clientes
                </p>
                
                <div class="form-group">
                    <label>üì± WhatsApp (formato: 56912345678)</label>
                    <input type="tel" id="whatsappNumber" placeholder="56912345678" pattern="[0-9]{11,15}">
                </div>

                <div class="form-group">
                    <label>üìß Email</label>
                    <input type="email" id="emailAddress" placeholder="veterinaria@ejemplo.com">
                </div>

                <button class="primary" onclick="saveNotifications()">üíæ Guardar Notificaciones</button>

                <hr style="margin: 30px 0; border: none; border-top: 2px dashed #e0e0e0;">

                <h3 style="margin-bottom: 15px; color: var(--primary-dark);">üìß Configuraci√≥n de Emails Autom√°ticos (EmailJS)</h3>
                <p style="color: var(--text-light); margin-bottom: 20px; font-size: 0.95rem;">
                    Configura EmailJS para enviar emails 100% autom√°ticos sin costo. 
                    <a href="#" onclick="showEmailJSInstructions(); return false;" style="color: var(--primary); font-weight: 600;">Ver instrucciones paso a paso ‚Üí</a>
                </p>
                
                <div class="form-group">
                    <label>üîë Public Key (Clave P√∫blica)</label>
                    <input type="text" id="emailjsPublicKey" placeholder="Ej: XyZ123AbC456...">
                </div>

                <div class="form-group">
                    <label>üåê Service ID</label>
                    <input type="text" id="emailjsServiceId" placeholder="Ej: service_abc123">
                </div>

                <div class="form-group">
                    <label>üìÑ Template ID - Agenda</label>
                    <input type="text" id="emailjsTemplateAgenda" placeholder="Ej: template_agenda123">
                    <small style="color: var(--text-light); display: block; margin-top: 5px;">
                        üìß Se env√≠a al VET y al CLIENTE cuando se CREA una cita
                    </small>
                </div>

                <div class="form-group">
                    <label>‚ùå Template ID - Cancelaci√≥n</label>
                    <input type="text" id="emailjsTemplateCancelacion" placeholder="Ej: template_cancel123">
                </div>

                <button class="primary" onclick="saveEmailJSConfig()">üíæ Guardar Configuraci√≥n EmailJS</button>
                <button class="secondary" style="margin-left: 10px;" onclick="testEmailJS()">‚úâÔ∏è Probar Env√≠o</button>

                <hr style="margin: 30px 0; border: none; border-top: 2px dashed #e0e0e0;">

                <h3 style="margin-bottom: 15px; color: var(--primary-dark);">üìç Comunas Disponibles</h3>
                <div class="admin-controls">
                    <input type="text" id="newComuna" placeholder="Ej: Las Condes">
                    <button class="secondary" onclick="addComuna()">+ Agregar Comuna</button>
                </div>
                <div id="comunasList"></div>

                <hr style="margin: 30px 0; border: none; border-top: 2px dashed #e0e0e0;">

                <h3 style="margin-bottom: 15px; color: var(--primary-dark);">üïê Horarios de Atenci√≥n</h3>
                <div class="admin-controls">
                    <input type="time" id="startTime" value="09:00">
                    <input type="time" id="endTime" value="18:00">
                    <input type="number" id="slotDuration" placeholder="Duraci√≥n (min)" value="60" min="15" step="15">
                    <button class="secondary" onclick="addSchedule()">+ Agregar Horario</button>
                </div>
                <div id="schedulesList"></div>

                <hr style="margin: 30px 0; border: none; border-top: 2px dashed #e0e0e0;">

                <h3 style="margin-bottom: 15px; color: var(--primary-dark);">üìÖ D√≠as de Atenci√≥n</h3>
                <p style="color: var(--text-light); margin-bottom: 15px; font-size: 0.95rem;">
                    Selecciona los d√≠as de la semana en que atiendes
                </p>
                <div class="days-grid">
                    <div>
                        <input type="checkbox" id="day0" class="day-checkbox" value="0">
                        <label for="day0" class="day-label">
                            <span class="day-icon">‚òÄÔ∏è</span>
                            <span class="day-name">Domingo</span>
                        </label>
                    </div>
                    <div>
                        <input type="checkbox" id="day1" class="day-checkbox" value="1">
                        <label for="day1" class="day-label">
                            <span class="day-icon">üìÖ</span>
                            <span class="day-name">Lunes</span>
                        </label>
                    </div>
                    <div>
                        <input type="checkbox" id="day2" class="day-checkbox" value="2">
                        <label for="day2" class="day-label">
                            <span class="day-icon">üìÖ</span>
                            <span class="day-name">Martes</span>
                        </label>
                    </div>
                    <div>
                        <input type="checkbox" id="day3" class="day-checkbox" value="3">
                        <label for="day3" class="day-label">
                            <span class="day-icon">üìÖ</span>
                            <span class="day-name">Mi√©rcoles</span>
                        </label>
                    </div>
                    <div>
                        <input type="checkbox" id="day4" class="day-checkbox" value="4">
                        <label for="day4" class="day-label">
                            <span class="day-icon">üìÖ</span>
                            <span class="day-name">Jueves</span>
                        </label>
                    </div>
                    <div>
                        <input type="checkbox" id="day5" class="day-checkbox" value="5">
                        <label for="day5" class="day-label">
                            <span class="day-icon">üìÖ</span>
                            <span class="day-name">Viernes</span>
                        </label>
                    </div>
                    <div>
                        <input type="checkbox" id="day6" class="day-checkbox" value="6">
                        <label for="day6" class="day-label">
                            <span class="day-icon">üéâ</span>
                            <span class="day-name">S√°bado</span>
                        </label>
                    </div>
                </div>
                <button class="primary" style="margin-top: 15px;" onclick="saveWorkingDays()">üíæ Guardar D√≠as de Atenci√≥n</button>
                <button class="secondary" style="margin-top: 10px;" onclick="resetConfig()">üîÑ Restaurar Configuraci√≥n por Defecto</button>
            </div>

            <div class="card" style="margin-top: 20px;">
                <h3 style="margin-bottom: 15px; color: var(--primary-dark);">üìã Gesti√≥n de Citas</h3>
                
                <div style="margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="secondary" onclick="filterAppointments('all')">Todas</button>
                    <button class="secondary" onclick="filterAppointments('Pendiente')">Pendientes</button>
                    <button class="secondary" onclick="filterAppointments('Realizada')">Realizadas</button>
                    <button class="secondary" onclick="filterAppointments('Cancelada')">Canceladas</button>
                </div>
                
            </div>

            <div class="card" style="margin-top: 20px;">
                <h3 style="margin-bottom: 15px; color: var(--primary-dark);">üîê Cambiar Contrase√±a</h3>
                <div class="form-group">
                    <label>Contrase√±a Actual</label>
                    <input type="password" id="currentPassword" placeholder="Ingresa tu contrase√±a actual">
                </div>
                <div class="form-group">
                    <label>Nueva Contrase√±a</label>
                    <input type="password" id="newPassword" placeholder="Ingresa tu nueva contrase√±a">
                </div>
                <div class="form-group">
                    <label>Confirmar Nueva Contrase√±a</label>
                    <input type="password" id="confirmPassword" placeholder="Confirma tu nueva contrase√±a">
                </div>
                <button class="primary" onclick="changePassword()">Actualizar Contrase√±a</button>
            </div>

            </div>
            <!-- FIN Subtab: Config -->

            <!-- Contenido Subtab: Veterinario -->
            <div id="subtab-veterinario" class="subtab-content">
                
                <!-- Gesti√≥n de Citas -->
                <div class="card">
                    <h3 style="margin-bottom: 15px; color: var(--primary-dark);">üìã Gesti√≥n de Citas</h3>
                    
                    <div style="margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="secondary" onclick="filterAppointments('all')">Todas</button>
                        <button class="secondary" onclick="filterAppointments('Pendiente')">Pendientes</button>
                        <button class="secondary" onclick="filterAppointments('Realizada')">Realizadas</button>
                        <button class="secondary" onclick="filterAppointments('Cancelada')">Canceladas</button>
                    </div>
                    
                    <div id="adminAppointmentsList"></div>
                </div>

                <!-- Configuraci√≥n de Horarios y D√≠as -->
                <div class="card" style="margin-top: 20px;">
                    <h3 style="margin-bottom: 15px; color: var(--primary-dark);">üìÖ Horarios de Atenci√≥n</h3>
                    <p style="color: var(--text-light); margin-bottom: 15px;">
                        Define los bloques de horario disponibles para agendar citas.
                    </p>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 15px;">
                        <div>
                            <label>Hora Inicio</label>
                            <input type="time" id="startTime" value="09:00">
                        </div>
                        <div>
                            <label>Hora Fin</label>
                            <input type="time" id="endTime" value="13:00">
                        </div>
                        <div>
                            <label>Duraci√≥n (min)</label>
                            <input type="number" id="slotDuration" value="60" min="15" max="180" step="15">
                        </div>
                    </div>
                    <button class="secondary" onclick="addSchedule()">+ Agregar Horario</button>
                    
                    <div id="schedulesList" style="margin-top: 20px;"></div>
                </div>

                <div class="card" style="margin-top: 20px;">
                    <h3 style="margin-bottom: 15px; color: var(--primary-dark);">üìÖ D√≠as de Atenci√≥n</h3>
                    <p style="color: var(--text-light); margin-bottom: 15px;">
                        Selecciona los d√≠as de la semana en que atiendes.
                    </p>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 10px;">
                        <label style="display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" id="day1" value="1">
                            <span>Lunes</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" id="day2" value="2">
                            <span>Martes</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" id="day3" value="3">
                            <span>Mi√©rcoles</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" id="day4" value="4">
                            <span>Jueves</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" id="day5" value="5">
                            <span>Viernes</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" id="day6" value="6">
                            <span>S√°bado</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" id="day0" value="0">
                            <span>Domingo</span>
                        </label>
                    </div>
                    <button class="primary" style="margin-top: 15px;" onclick="saveWorkingDays()">üíæ Guardar D√≠as de Atenci√≥n</button>
                    <button class="secondary" style="margin-top: 10px;" onclick="resetConfig()">üîÑ Restaurar Configuraci√≥n por Defecto</button>
                </div>


            </div>
            <!-- FIN Subtab: Veterinario -->

        </div>
    </div>

    <!-- Modal de autenticaci√≥n -->
    <div id="authModal" class="modal-overlay">
        <div class="modal">
            <h3>üîí Acceso Restringido</h3>
            <p>Ingresa la contrase√±a para acceder a la configuraci√≥n</p>
            <input type="password" id="passwordInput" placeholder="Contrase√±a" onkeypress="if(event.key === 'Enter') checkPassword()">
            <div class="modal-buttons">
                <button class="btn-cancel" onclick="closeAuthModal()">Cancelar</button>
                <button class="btn-confirm" onclick="checkPassword()">Ingresar</button>
            </div>

        </div>
    </div>

    <script>
        // ========================================
        // üîó GOOGLE SHEETS SYNC
        // ========================================
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbz9_qWhIuqxu_M-MSWTJenqfqovPMaBeAUii7PvYyBymYp-UNXD-f8AMQfizsrylWbE/exec';
        
async function sendToGoogleSheets(action, data) {
  try {
    await fetch(GOOGLE_SCRIPT_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        action,
        ...data,   // aqu√≠ llega { appointment }
      }),
    });
      console.log("Sincronizado con Google Sheets");
    return true;
  } catch (error) {
    console.warn("No se pudo sincronizar con Google Sheets", error);
    return true;
  }
}

        
        async function syncAppointmentsFromSheets() {
            console.log('üîÑ Intentando sincronizar con Google Sheets...');
            
            // Primero, obtener citas locales
            let localAppointments = [];
            try {
                const stored = localStorage.getItem('appointments');
                localAppointments = stored && stored !== 'undefined' && stored !== 'null' ? JSON.parse(stored) : [];
                console.log('üíæ Citas locales:', localAppointments.length);
            } catch (e) {
                console.error('‚ùå Error al leer citas locales:', e);
            }
            
            // Intentar sincronizar con Sheets
            try {
                const response = await fetch(GOOGLE_SCRIPT_URL + '?action=getAll');
                const data = await response.json();
                
                if (data && data.result === 'success') {
                    console.log('‚úÖ Sincronizado con Google Sheets');
                    console.log('üìä Citas de Sheets:', data.appointments ? data.appointments.length : 0);
                    
                    // Merge: combinar citas de Sheets con citas locales
                    const sheetsAppointments = data.appointments || [];
                    const sheetsIds = new Set(sheetsAppointments.map(a => a.id));
                    
                    // Agregar citas locales que no est√°n en Sheets
                    const localOnly = localAppointments.filter(a => !sheetsIds.has(a.id));
                    console.log('üÜï Citas solo locales (no en Sheets):', localOnly.length);
                    
                    const merged = [...sheetsAppointments, ...localOnly];
                    console.log('üîÄ Total despu√©s de merge:', merged.length);
                    
                    localStorage.setItem('appointments', JSON.stringify(merged));
                    return merged;
                }
            } catch (error) {
                console.warn('‚ö†Ô∏è Error al sincronizar con Sheets, usando datos locales:', error.message);
            }
            
            // Fallback a localStorage si falla la sincronizaci√≥n
            console.log('üíæ Usando solo datos locales');
            return localAppointments;
        }
        
        // ========================================
        // CONFIGURACI√ìN
        // ========================================
        
        // Configuraci√≥n por defecto
        const defaultConfig = {
            comunas: ['La Florida', 'Puente Alto'],
            schedules: [
                { start: '09:00', end: '13:00', duration: 60 },
                { start: '14:00', end: '18:00', duration: 60 }
            ],
            instagram: 'https://instagram.com/',
            password: 'admin123', // Contrase√±a por defecto
            whatsappNumber: '56995409035', // N√∫mero de WhatsApp del veterinario
            email: 'manadapatitasveterinaria@gmail.com', // Email del veterinario
            workingDays: [1, 2, 3, 4, 5], // 0=Domingo, 1=Lunes, 2=Martes, 3=Mi√©rcoles, 4=Jueves, 5=Viernes, 6=S√°bado
            emailjs: {
                publicKey: '',
                serviceId: '',
                templateIdAgenda: '',
                templateIdCancelacion: '',

            }
        };

        // Variable para controlar autenticaci√≥n
        let isAuthenticated = false;
        let clientAccessCode = null; // C√≥digo de acceso del cliente actual

        // Generar c√≥digo √∫nico de 6 caracteres
        function generateAccessCode() {
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789'; // Sin letras confusas (I, O) ni n√∫meros (0, 1)
            let code = '';
            for (let i = 0; i < 6; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }

        // Inicializar configuraci√≥n
        function initConfig() {
            if (!localStorage.getItem('vetConfig')) {
                localStorage.setItem('vetConfig', JSON.stringify(defaultConfig));
            }
        }

        // Obtener configuraci√≥n

        // Sincronizar configuraci√≥n desde Google Sheets (para multi-dispositivo)
        async function syncConfigFromSheets() {
            try {
                const response = await fetch(GOOGLE_SCRIPT_URL + '?action=getConfig');
                const data = await response.json();
                
                if (data && data.result === 'success' && data.config) {
                    localStorage.setItem('vetConfig', JSON.stringify(data.config));
                    return data.config;
                }
            } catch (error) {
                // Silencioso - solo usar local si falla
            }
            
            // Fallback a localStorage
            const stored = localStorage.getItem('vetConfig');
            return stored ? JSON.parse(stored) : defaultConfig;
        }


        // Formatear fecha para mostrar (ej: "17 de febrero de 2026")
        function formatDate(dateStr) {
            if (!dateStr) return 'Sin fecha';
            
            // Si viene como string "2026-02-17", parsearlo
            const date = new Date(dateStr);
            
            if (isNaN(date.getTime())) {
                return dateStr; // Retornar original si no se puede parsear
            }
            
            const meses = [
                'enero', 'febrero', 'marzo', 'abril', 'mayo', 'junio',
                'julio', 'agosto', 'septiembre', 'octubre', 'noviembre', 'diciembre'
            ];
            
            const dia = date.getDate();
            const mes = meses[date.getMonth()];
            const a√±o = date.getFullYear();
            
            return `${dia} de ${mes} de ${a√±o}`;
        }


        // Formatear hora para mostrar solo HH:MM
        function formatTime(timeStr) {
            if (!timeStr) return 'Sin hora';
            
            // Si es solo hora tipo "11:00", retornar tal cual
            if (timeStr.match(/^\d{1,2}:\d{2}$/)) {
                return timeStr;
            }
            
            // Si viene como timestamp "1899-12-30T15:42:45.000Z"
            if (timeStr.includes('T')) {
                const date = new Date(timeStr);
                const hours = String(date.getUTCHours()).padStart(2, '0');
                const minutes = String(date.getUTCMinutes()).padStart(2, '0');
                return `${hours}:${minutes}`;
            }
            
            return timeStr; // Retornar original si no se puede parsear
        }

        function getConfig() {
            return JSON.parse(localStorage.getItem('vetConfig')) || defaultConfig;
        }

        // Guardar configuraci√≥n
        async function saveConfig(config) {
            // Guardar local (inmediato)
            localStorage.setItem('vetConfig', JSON.stringify(config));
            
            // Sincronizar con Sheets (background - no bloquear)
            try {
                await sendToGoogleSheets('saveConfig', { config: config });
            } catch (error) {
                // Silencioso - no importa si falla
            }
        }

        // Mostrar modal de autenticaci√≥n
        function showAuthModal() {
            document.getElementById('authModal').classList.add('active');
            document.getElementById('passwordInput').value = '';
            document.getElementById('passwordInput').focus();
        }

        // Cerrar modal de autenticaci√≥n
        function closeAuthModal() {
            document.getElementById('authModal').classList.remove('active');
            document.getElementById('passwordInput').value = '';
        }

        // Verificar contrase√±a
        async function checkPassword() {
            const config = getConfig();
            const inputPassword = document.getElementById('passwordInput').value;
            
            if (inputPassword === config.password) {
                isAuthenticated = true;
                closeAuthModal();
                
                // Activar la pesta√±a de admin
                document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                
                document.querySelector('.tab:last-child').classList.add('active');
                document.getElementById('admin').classList.add('active');
                
                // Cargar panel y sincronizar configuraci√≥n
                await loadAdminPanel();
            } else {
                alert('‚ùå Contrase√±a incorrecta');
                document.getElementById('passwordInput').value = '';
                document.getElementById('passwordInput').focus();
            }
        }

        // Cambiar contrase√±a
        function changePassword() {
            const config = getConfig();
            const current = document.getElementById('currentPassword').value;
            const newPass = document.getElementById('newPassword').value;
            const confirm = document.getElementById('confirmPassword').value;

            if (!current || !newPass || !confirm) {
                alert('‚ö†Ô∏è Por favor completa todos los campos');
                return;
            }

            if (current !== config.password) {
                alert('‚ùå La contrase√±a actual es incorrecta');
                return;
            }

            if (newPass !== confirm) {
                alert('‚ùå Las contrase√±as no coinciden');
                return;
            }

            if (newPass.length < 6) {
                alert('‚ö†Ô∏è La contrase√±a debe tener al menos 6 caracteres');
                return;
            }

            config.password = newPass;
            saveConfig(config);
            
            // Limpiar campos
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
            
            alert('‚úÖ Contrase√±a actualizada correctamente');
        }

        // Cambiar de tab



        // Cambiar entre subtabs dentro de Acceso Veterinario
        function switchSubtab(subtabName) {
            // Ocultar todos los subtabs
            document.querySelectorAll('.subtab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remover active de todos los botones
            document.querySelectorAll('.subtab').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Mostrar el subtab seleccionado
            const subtabContent = document.getElementById('subtab-' + subtabName);
            if (subtabContent) {
                subtabContent.classList.add('active');
            }
            const subtabButton = document.getElementById('subtab' + subtabName.charAt(0).toUpperCase() + subtabName.slice(1));
            if (subtabButton) {
                subtabButton.classList.add('active');
            }
            
            // Si es veterinario, cargar las citas
            if (subtabName === 'veterinario') {
                loadAdminAppointments('all');
            }
        }

        async function switchTab(tabName) {
            // Si intenta acceder a admin y no est√° autenticado
            if (tabName === 'admin' && !isAuthenticated) {
                showAuthModal();
                return;
            }

            // Si cambia de tab desde admin, cerrar sesi√≥n
            if (tabName !== 'admin') {
                isAuthenticated = false;
            }

            // Si cambia de tab desde "Mis Citas", resetear c√≥digo de cliente
            if (tabName !== 'citas') {
                resetAccessCode();
            }

            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // Encontrar el tab correcto y activarlo
            const tabs = document.querySelectorAll('.tab');
            const tabNames = ['servicios', 'agendar', 'citas', 'admin'];
            const tabIndex = tabNames.indexOf(tabName);
            if (tabIndex !== -1 && tabs[tabIndex]) {
                tabs[tabIndex].classList.add('active');
            }
            
            document.getElementById(tabName).classList.add('active');

            if (tabName === 'admin') {
                await loadAdminPanel();
            } else if (tabName === 'citas') {
                // Resetear vista de citas al entrar
                resetAccessCode();
            } else if (tabName === 'servicios') {
                updateContactDisplay();
            } else if (tabName === 'agendar') {
                showAvailableDays();
            }
        }

        // Mostrar d√≠as disponibles en el formulario
        function showAvailableDays() {
            const config = getConfig();
            const workingDays = config.workingDays || [1, 2, 3, 4, 5];
            const dayNames = ['domingo', 'lunes', 'martes', 'mi√©rcoles', 'jueves', 'viernes', 's√°bado'];
            const availableDayNames = workingDays.map(d => dayNames[d]).join(', ');
            
            const infoElement = document.getElementById('availableDaysInfo');
            if (infoElement) {
                infoElement.textContent = `D√≠as disponibles: ${availableDayNames}`;
            }
        }

        // Cargar panel de administraci√≥n
        async function loadAdminPanel() {
            // Sincronizar configuraci√≥n desde Google Sheets
            console.log('üîÑ Sincronizando configuraci√≥n desde Sheets...');
            const config = await syncConfigFromSheets();
            console.log('‚úÖ Configuraci√≥n cargada:', config);
            
            // Cargar Instagram
            document.getElementById('instagramUrl').value = config.instagram;
            
            // Cargar WhatsApp y Email
            document.getElementById('whatsappNumber').value = config.whatsappNumber || '';
            document.getElementById('emailAddress').value = config.email || '';
            
            // Cargar configuraci√≥n de EmailJS
            if (config.emailjs) {
                document.getElementById('emailjsPublicKey').value = config.emailjs.publicKey || '';
                document.getElementById('emailjsServiceId').value = config.emailjs.serviceId || '';
                document.getElementById('emailjsTemplateAgenda').value = config.emailjs.templateIdAgenda || '';
                document.getElementById('emailjsTemplateCancelacion').value = config.emailjs.templateIdCancelacion || '';
            }
            
            // Cargar comunas
            const comunasList = document.getElementById('comunasList');
            comunasList.innerHTML = config.comunas.map(comuna => `
                <div class="schedule-item">
                    <span><strong>${comuna}</strong></span>
                    <button class="delete-btn" onclick="deleteComuna('${comuna}')">üóëÔ∏è Eliminar</button>
                </div>
            `).join('');

            // Cargar horarios
            const schedulesList = document.getElementById('schedulesList');
            if (!config.schedules || config.schedules.length === 0) {
                schedulesList.innerHTML = `
                    <div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 8px; border: 2px dashed #dee2e6;">
                        <p style="color: var(--text-light); margin: 0;">‚ö†Ô∏è No hay horarios configurados</p>
                        <p style="color: var(--text-light); font-size: 0.9rem; margin-top: 5px;">Agrega al menos un horario para poder recibir citas</p>
                    </div>
                `;
            } else {
                schedulesList.innerHTML = config.schedules.map((schedule, index) => `
                <div class="schedule-item">
                    <span><strong>${schedule.start}</strong> a <strong>${schedule.end}</strong> - ${schedule.duration} min</span>
                    <button class="delete-btn" onclick="deleteSchedule(${index})">üóëÔ∏è Eliminar</button>
                </div>
            `).join('');
            }

            // Cargar d√≠as de la semana
            const workingDays = config.workingDays || [1, 2, 3, 4, 5];
            for (let i = 0; i < 7; i++) {
                const checkbox = document.getElementById(`day${i}`);
                if (checkbox) {
                    checkbox.checked = workingDays.includes(i);
                }
            }

            // Cargar citas para gesti√≥n
            loadAdminAppointments('all');
        }

        // Cargar citas en vista de administrador
        async function loadAdminAppointments(filter = 'all') {
            const appointments = await syncAppointmentsFromSheets();
            const container = document.getElementById('adminAppointmentsList');
            
            // Validar que appointments sea un array
            if (!appointments || !Array.isArray(appointments)) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-light); padding: 40px;">No hay citas registradas</p>';
                return;
            }

            let filteredAppointments = appointments;
            if (filter !== 'all') {
                filteredAppointments = appointments.filter(apt => apt.status === filter);
            }

            if (filteredAppointments.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-light); padding: 40px;">No hay citas en esta categor√≠a</p>';
                return;
            }

            container.innerHTML = filteredAppointments
                .sort((a, b) => new Date(a.date + ' ' + a.time) - new Date(b.date + ' ' + b.time))
                .map(apt => {
                    const statusClass = apt.status.toLowerCase().replace(' ', '');
                    const isPending = apt.status === 'Pendiente';
                    
                    return `
                    <div class="appointment-card ${statusClass}">
                        <div class="appointment-header">
                            <div class="appointment-name">üêæ ${apt.petName}</div>
                            <span class="badge ${statusClass}">${apt.status}</span>
                        </div>
                        <div class="appointment-info">
                            <strong>Due√±o:</strong> ${apt.ownerName}<br>
                            <strong>Fecha:</strong> ${formatDate(apt.date)}<br>
                            <strong>Hora:</strong> ${formatTime(apt.time)}<br>
                            <strong>Direcci√≥n:</strong> ${apt.address || 'No especificada'}<br>
                            <strong>Comuna:</strong> ${apt.comuna}<br>
                            <strong>Tel√©fono:</strong> ${apt.phone}<br>
                            ${apt.reason ? `<strong>Motivo:</strong> ${apt.reason}<br>` : ''}
                        </div>
                        
                        <div class="action-buttons" style="margin-top: 15px; border-top: 1px solid #e0e0e0; padding-top: 15px;">
                            <button class="btn-action" style="background: #4285f4; color: white;" 
                                    onclick="window.open(createGoogleCalendarUrl(${JSON.stringify(apt)}), '_blank')">
                                üìÖ Google Calendar
                            </button>
                            <button class="btn-action" style="background: #34a853; color: white;" 
                                    onclick="downloadICS(${JSON.stringify(apt)})">
                                üì• Descargar .ics
                            </button>
                        </div>
                        
                        ${isPending ? `
                        <div class="action-buttons">
                            <button class="btn-action btn-complete" onclick="markAsCompleted(${apt.id})">
                                ‚úÖ Marcar como Realizada
                            </button>
                            <button class="btn-action btn-cancel" onclick="cancelAppointment(${apt.id}, true)">
                                ‚ùå Cancelar Cita
                            </button>
                        </div>
                        ` : ''}
                    </div>
                `;
                }).join('');
        }

        // Filtrar citas en vista admin
        function filterAppointments(filter) {
            loadAdminAppointments(filter);
        }

        // Guardar Instagram
        function saveInstagram() {
            const config = getConfig();
            const url = document.getElementById('instagramUrl').value;
            config.instagram = url;
            saveConfig(config);
            document.getElementById('instagramLink').href = url;
            alert('‚úÖ URL de Instagram guardada correctamente');
        }

        // Guardar configuraci√≥n de notificaciones
        function saveNotifications() {
            const config = getConfig();
            const whatsapp = document.getElementById('whatsappNumber').value.trim();
            const email = document.getElementById('emailAddress').value.trim();

            // Validar WhatsApp si se ingres√≥
            if (whatsapp && !/^[0-9]{11,15}$/.test(whatsapp)) {
                alert('‚ö†Ô∏è El n√∫mero de WhatsApp debe tener entre 11-15 d√≠gitos (sin espacios ni caracteres especiales)\nEjemplo: 56912345678');
                return;
            }

            // Validar email si se ingres√≥
            if (email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                alert('‚ö†Ô∏è El email no tiene un formato v√°lido');
                return;
            }

            config.whatsappNumber = whatsapp;
            config.email = email;
            saveConfig(config);
            
            alert('‚úÖ Configuraci√≥n de notificaciones guardada correctamente');
        }

        // Guardar configuraci√≥n de EmailJS
        function saveEmailJSConfig() {
            const config = getConfig();
            
            config.emailjs = {
                publicKey: document.getElementById('emailjsPublicKey').value.trim(),
                serviceId: document.getElementById('emailjsServiceId').value.trim(),
                templateIdAgenda: document.getElementById('emailjsTemplateAgenda').value.trim(),
                templateIdCancelacion: document.getElementById('emailjsTemplateCancelacion').value.trim()
            };
            
            saveConfig(config);
            
            // Inicializar EmailJS con la nueva configuraci√≥n
            if (config.emailjs.publicKey) {
                emailjs.init(config.emailjs.publicKey);
            }
            
            alert('‚úÖ Configuraci√≥n de EmailJS guardada correctamente');
        }

        // Probar EmailJS
        function testEmailJS() {
            const config = getConfig();
            
            if (!config.emailjs || !config.emailjs.publicKey) {
                alert('‚ö†Ô∏è Primero debes configurar EmailJS');
                return;
            }

            const testData = {
                to_email: config.email || 'test@ejemplo.com',
                owner_name: 'Cliente de Prueba',
                pet_name: 'Firulais',
                phone: '+56 9 1234 5678',
                comuna: 'Santiago',
                date: 'lunes, 15 de febrero de 2026',
                time: '10:00',
                reason: 'Prueba del sistema de emails autom√°ticos'
            };

            sendEmailNotification(testData, 'vet');
        }

        // Mostrar instrucciones de EmailJS
        function showEmailJSInstructions() {
            alert(`üìß C√ìMO CONFIGURAR EMAILJS (100% GRATIS)

1Ô∏è‚É£ Crea una cuenta:
   ‚Ä¢ Ve a https://www.emailjs.com
   ‚Ä¢ Reg√≠strate gratis (200 emails/mes)

2Ô∏è‚É£ Crea un servicio de email:
   ‚Ä¢ Dashboard ‚Üí Email Services
   ‚Ä¢ Conecta tu Gmail o Outlook
   ‚Ä¢ Copia el "Service ID"

3Ô∏è‚É£ Crea templates (plantillas):
   ‚Ä¢ Dashboard ‚Üí Email Templates
   ‚Ä¢ Crea 2 templates:
   
   TEMPLATE VETERINARIO:
   Subject: Nueva Cita - {{pet_name}}
   Body:
   üêæ NUEVA CITA VETERINARIA
   
   Due√±o: {{owner_name}}
   Mascota: {{pet_name}}
   Tel√©fono: {{phone}}
   Comuna: {{comuna}}
   Fecha: {{date}}
   Hora: {{time}}
   Motivo: {{reason}}
   
   TEMPLATE CLIENTE:
   Subject: Cita Confirmada - {{pet_name}}
   Body:
   ‚úÖ CITA CONFIRMADA
   
   Hola {{owner_name}},
   
   Tu cita para {{pet_name}} ha sido confirmada:
   Fecha: {{date}}
   Hora: {{time}}
   Comuna: {{comuna}}
   
   üîë C√ìDIGO DE TU CITA: {{access_code}}
   (Guarda este c√≥digo para ver o cancelar tu cita)

4Ô∏è‚É£ Obt√©n las credenciales:
   ‚Ä¢ Public Key: Account ‚Üí General
   ‚Ä¢ Service ID: Del servicio creado
   ‚Ä¢ Template IDs: De cada template

5Ô∏è‚É£ Pega aqu√≠ las credenciales y guarda

¬°Listo! Los emails se enviar√°n autom√°ticamente.`);
        }

        // Enviar email usando EmailJS
        async function sendEmailNotification(appointmentData, type) {
            const config = getConfig();
            
            if (!config.emailjs || !config.emailjs.publicKey) {
                return; // EmailJS no configurado, no hacer nada
            }

            // Usar template de AGENDA
            const templateId = config.emailjs.templateIdAgenda;
            const toEmail = type === 'vet' ? config.email : appointmentData.client_email;
            
            if (!templateId || !toEmail) {
                return; // No hay template o email configurado
            }

            try {
                const params = {
                    to_email: toEmail,
                    owner_name: appointmentData.owner_name,
                    pet_name: appointmentData.pet_name,
                    phone: appointmentData.phone,
                    address: appointmentData.address || '',
                    comuna: appointmentData.comuna,
                    date: appointmentData.date,
                    time: appointmentData.time,
                    reason: appointmentData.reason || 'No especificado',
                    access_code: appointmentData.access_code || '' // C√≥digo de acceso
                };

                await emailjs.send(config.emailjs.serviceId, templateId, params);
                console.log(`Email enviado a ${type}: ${toEmail}`);
            } catch (error) {
                console.error('Error al enviar email:', error);
            }
        }

        // Enviar email de cancelaci√≥n
        async function sendCancellationEmail(appointmentData, cancelledBy, type) {
            const config = getConfig();
            
            if (!config.emailjs || !config.emailjs.publicKey) {
                return;
            }

            // Usar template de CANCELACI√ìN
            const templateId = config.emailjs.templateIdCancelacion;
            const toEmail = type === 'vet' ? config.email : appointmentData.client_email;
            
            if (!templateId || !toEmail) {
                return;
            }

            try {
                const params = {
                    to_email: toEmail,
                    owner_name: appointmentData.owner_name,
                    pet_name: appointmentData.pet_name,
                    phone: appointmentData.phone,
                    address: appointmentData.address || '',
                    comuna: appointmentData.comuna,
                    date: appointmentData.date,
                    time: appointmentData.time,
                    reason: `CANCELADA por ${cancelledBy}`,
                    status: 'CANCELADA',
                    access_code: appointmentData.access_code || ''
                };

                await emailjs.send(config.emailjs.serviceId, templateId, params);
                console.log(`Email de cancelaci√≥n enviado a ${type}: ${toEmail}`);
            } catch (error) {
                console.error('Error al enviar email de cancelaci√≥n:', error);
            }
        }

        // Actualizar el WhatsApp mostrado en la secci√≥n de servicios
        // Actualizar WhatsApp y Email mostrados en servicios
        function updateContactDisplay() {
            const config = getConfig();
            
            // Actualizar WhatsApp
            const whatsappDisplay = document.getElementById('whatsappDisplay');
            if (config.whatsappNumber) {
                // Formatear el n√∫mero para mostrar (56912345678 -> +(56) 9 1234 5678)
                const num = config.whatsappNumber;
                const formatted = `+(${num.slice(0, 2)}) ${num.slice(2, 3)} ${num.slice(3, 7)} ${num.slice(7)}`;
                whatsappDisplay.textContent = formatted;
            }
            
            // Actualizar Email
            const emailDisplay = document.getElementById('emailDisplay');
            if (config.email) {
                emailDisplay.textContent = config.email;
            }
        }

        // Agregar comuna
        async function addComuna() {
            const newComuna = document.getElementById('newComuna').value.trim();
            if (!newComuna) {
                alert('‚ö†Ô∏è Por favor ingresa un nombre de comuna');
                return;
            }

            const config = getConfig();
            if (config.comunas.includes(newComuna)) {
                alert('‚ö†Ô∏è Esta comuna ya existe');
                return;
            }

            config.comunas.push(newComuna);
            saveConfig(config);
            document.getElementById('newComuna').value = '';
            await loadAdminPanel();
            loadComunasSelect();
        }

        // Eliminar comuna
        async function deleteComuna(comuna) {
            if (!confirm(`¬øEliminar la comuna ${comuna}?`)) return;
            
            const config = getConfig();
            config.comunas = config.comunas.filter(c => c !== comuna);
            saveConfig(config);
            await loadAdminPanel();
            loadComunasSelect();
        }

        // Agregar horario
        async function addSchedule() {
            const start = document.getElementById('startTime').value;
            const end = document.getElementById('endTime').value;
            const duration = parseInt(document.getElementById('slotDuration').value);

            if (!start || !end || !duration) {
                alert('‚ö†Ô∏è Por favor completa todos los campos');
                return;
            }

            const config = getConfig();
            config.schedules.push({ start, end, duration });
            saveConfig(config);
            await loadAdminPanel();
        }

        // Eliminar horario
        async function deleteSchedule(index) {
            if (!confirm('¬øEliminar este horario?')) return;
            
            const config = getConfig();
            config.schedules.splice(index, 1);
            saveConfig(config);
            await loadAdminPanel();
        }

        // Resetear configuraci√≥n a valores por defecto
        async function resetConfig() {
            if (!confirm('‚ö†Ô∏è Esto restaurar√° TODOS los valores por defecto (horarios, d√≠as, comunas, etc.)\n\n¬øEst√°s seguro?')) {
                return;
            }
            
            localStorage.setItem('vetConfig', JSON.stringify(defaultConfig));
            alert('‚úÖ Configuraci√≥n restaurada a valores por defecto');
            await loadAdminPanel();
        }

        // Guardar d√≠as de atenci√≥n
        function saveWorkingDays() {
            const config = getConfig();
            const selectedDays = [];
            
            for (let i = 0; i < 7; i++) {
                const checkbox = document.getElementById(`day${i}`);
                if (checkbox && checkbox.checked) {
                    selectedDays.push(i);
                }
            }

            if (selectedDays.length === 0) {
                alert('‚ö†Ô∏è Debes seleccionar al menos un d√≠a de atenci√≥n');
                return;
            }

            config.workingDays = selectedDays;
            saveConfig(config);
            
            const dayNames = ['Domingo', 'Lunes', 'Martes', 'Mi√©rcoles', 'Jueves', 'Viernes', 'S√°bado'];
            const selectedNames = selectedDays.map(d => dayNames[d]).join(', ');
            alert(`‚úÖ D√≠as de atenci√≥n guardados:\n${selectedNames}`);
        }

        // Cargar comunas en el select
        function loadComunasSelect() {
            const config = getConfig();
            const select = document.getElementById('comuna');
            select.innerHTML = '<option value="">Selecciona tu comuna</option>' +
                config.comunas.map(comuna => `<option value="${comuna}">${comuna}</option>`).join('');
        }

        // Generar slots de tiempo
        function generateTimeSlots() {
            const config = getConfig();
            const date = document.getElementById('visitDate').value;
            const slotsContainer = document.getElementById('timeSlots');
            
            console.log('üîç generateTimeSlots llamado');
            console.log('üìÖ Fecha seleccionada:', date);
            console.log('‚è∞ Horarios configurados:', config.schedules);
            
            if (!date) {
                slotsContainer.innerHTML = '<p style="text-align: center; color: var(--text-light);">Primero selecciona una fecha</p>';
                return;
            }
            
            // Verificar si hay horarios configurados
            if (!config.schedules || config.schedules.length === 0) {
                slotsContainer.innerHTML = `
                    <div style="text-align: center; padding: 30px; background: #fff3cd; border-radius: 8px; border: 2px solid #ffc107;">
                        <h3 style="color: #856404; margin-bottom: 10px;">‚ö†Ô∏è No hay horarios configurados</h3>
                        <p style="color: #856404; margin-bottom: 15px;">Para poder agendar citas, primero debes configurar los horarios de atenci√≥n.</p>
                        <button class="primary" onclick="switchTab('admin')" style="background: #ffc107; color: #000;">
                            üîí Ir a Configuraci√≥n
                        </button>
                    </div>
                `;
                return;
            }

            const bookedSlots = getBookedSlots(date);
            let slots = [];

            config.schedules.forEach(schedule => {
                const [startHour, startMin] = schedule.start.split(':').map(Number);
                const [endHour, endMin] = schedule.end.split(':').map(Number);
                
                let currentTime = startHour * 60 + startMin;
                const endTime = endHour * 60 + endMin;

                while (currentTime + schedule.duration <= endTime) {
                    const hour = Math.floor(currentTime / 60);
                    const min = currentTime % 60;
                    const timeStr = `${hour.toString().padStart(2, '0')}:${min.toString().padStart(2, '0')}`;
                    
                    const isBooked = bookedSlots.includes(timeStr);
                    slots.push({
                        time: timeStr,
                        available: !isBooked
                    });

                    currentTime += schedule.duration;
                }
            });

            console.log('‚ú® Slots generados:', slots.length, 'slots');
            console.log('üìã Slots:', slots);
            
            if (slots.length === 0) {
                slotsContainer.innerHTML = `
                    <div style="text-align: center; padding: 30px; background: #fff3cd; border-radius: 8px;">
                        <p style="color: #856404; margin: 0;">‚ö†Ô∏è No se generaron horarios para esta fecha</p>
                        <p style="color: #856404; font-size: 0.9rem; margin-top: 5px;">Verifica los horarios en Configuraci√≥n</p>
                    </div>
                `;
                return;
            }
            
            slotsContainer.innerHTML = slots.map(slot => `
                <div class="time-slot ${!slot.available ? 'unavailable' : ''}" 
                     onclick="${slot.available ? `selectTime('${slot.time}')` : ''}"
                     data-time="${slot.time}">
                    ${slot.time}
                </div>
            `).join('');
        }

        // Obtener slots reservados para una fecha
        function getBookedSlots(date) {
            try {
                const stored = localStorage.getItem('appointments');
                if (!stored || stored === 'undefined' || stored === 'null') {
                    return [];
                }
                const appointments = JSON.parse(stored);
                if (!Array.isArray(appointments)) {
                    return [];
                }
                return appointments
                    .filter(apt => apt.date === date)
                    .map(apt => apt.time);
            } catch (e) {
                console.error('‚ùå Error al leer appointments:', e);
                return [];
            }
        }

        // Seleccionar horario
        function selectTime(time) {
            document.querySelectorAll('.time-slot').forEach(slot => {
                slot.classList.remove('selected');
            });
            event.target.classList.add('selected');
            event.target.dataset.selected = 'true';
        }

        // Enviar formulario
        document.getElementById('appointmentForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const selectedSlot = document.querySelector('.time-slot.selected');
            if (!selectedSlot) {
                alert('‚ö†Ô∏è Por favor selecciona un horario');
                return;
            }

            const appointment = {
                id: Date.now(),
                ownerName: document.getElementById('ownerName').value,
                petName: document.getElementById('petName').value,
                phone: document.getElementById('phone').value,
                clientEmail: document.getElementById('clientEmail').value.trim(),
                comuna: document.getElementById('comuna').value,
                address: document.getElementById('address').value,
                date: document.getElementById('visitDate').value,
                time: selectedSlot.dataset.time,
                reason: document.getElementById('reason').value,
                status: 'Pendiente',
                accessCode: generateAccessCode() // C√≥digo √∫nico para acceder a la cita
            };

            // Guardar cita
            console.log('üíæ Guardando nueva cita...');
            console.log('üîë C√≥digo de acceso:', appointment.accessCode);
            
            const appointments = (function(){try{const s=localStorage.getItem('appointments');return s&&s!=='undefined'&&s!=='null'?JSON.parse(s):[];}catch(e){return [];}})() || [];
            appointments.push(appointment);
            localStorage.setItem('appointments', JSON.stringify(appointments));
            console.log('‚úÖ Cita guardada en localStorage. Total:', appointments.length);
            
            console.log("üì§ Enviando a Google Sheets...");
await sendToGoogleSheets("save", { appointment });  // <-- cambio aqu√≠
console.log("‚úÖ Enviado a Google Sheets");


            // Enviar notificaciones
            sendNotifications(appointment);

            // Mostrar mensaje de √©xito
            const config = getConfig();
            const hasEmailJS = config.emailjs && config.emailjs.publicKey;
            
            const successMsg = document.createElement('div');
            successMsg.className = 'success-message';
            successMsg.innerHTML = `
                ‚úÖ <strong>¬°Solicitud enviada con √©xito!</strong><br>
                Tu visita ha sido agendada para el ${formatDate(appointment.date)} a las ${appointment.time}.<br>
                <br>
                <div style="background: white; color: var(--primary-dark); padding: 15px; border-radius: 10px; margin: 15px 0; border: 3px dashed var(--primary);">
                    üîë <strong>C√ìDIGO DE TU CITA: ${appointment.accessCode}</strong><br>
                    <small style="color: var(--accent);">‚ö†Ô∏è GUARDA ESTE C√ìDIGO - Lo necesitar√°s para ver y cancelar tu cita</small>
                </div>
                ${hasEmailJS ? `
                    üìß <strong>Email autom√°tico enviado:</strong><br>
                    ${config.email ? '‚Ä¢ Al veterinario ‚úÖ<br>' : ''}
                    ${appointment.clientEmail ? '‚Ä¢ A tu email (' + appointment.clientEmail + ') ‚úÖ<br>' : ''}
                    <br>
                ` : ''}
                üì± <strong>WhatsApp pre-escrito (presiona "Enviar"):</strong><br>
                ‚Ä¢ Notificaci√≥n al veterinario<br>
                ‚Ä¢ Confirmaci√≥n a tu tel√©fono (${appointment.phone})<br>
                <br>
                <div style="display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; margin-top: 15px;">
                    <button class="btn-action" style="background: #4285f4; color: white;" 
                            onclick="window.open(createGoogleCalendarUrl(${JSON.stringify(appointment)}), '_blank')">
                        üìÖ Agregar a Google Calendar
                    </button>
                    <button class="btn-action" style="background: #34a853; color: white;" 
                            onclick="downloadICS(${JSON.stringify(appointment)})">
                        üì• Descargar .ics
                    </button>
                </div>
            `;
            
            this.insertAdjacentElement('beforebegin', successMsg);
            this.reset();
            document.getElementById('timeSlots').innerHTML = '';

            setTimeout(() => successMsg.remove(), 10000);
        });

        // Enviar notificaciones por WhatsApp y/o Email
        function sendNotifications(appointment) {
            const config = getConfig();
            
            // Preparar datos para EmailJS
            const emailData = {
                owner_name: appointment.ownerName,
                pet_name: appointment.petName,
                phone: appointment.phone,
                address: appointment.address || '',
                comuna: appointment.comuna,
                date: formatDate(appointment.date),
                time: formatTime(appointment.time),
                reason: appointment.reason || 'No especificado',
                client_email: appointment.clientEmail || '',
                access_code: appointment.accessCode
            };

            // EMAILS AUTOM√ÅTICOS con EmailJS (si est√° configurado)
            if (config.emailjs && config.emailjs.publicKey) {
                // Email al veterinario
                sendEmailNotification(emailData, 'vet');
                
                // Email al cliente (si proporcion√≥ email)
                if (appointment.clientEmail) {
                    sendEmailNotification(emailData, 'client');
                }
            }
            
            // Mensaje para el veterinario (WhatsApp)
            const messageToVet = `üêæ *NUEVA CITA VETERINARIA*

üë§ *Due√±o:* ${appointment.ownerName}
üêï *Mascota:* ${appointment.petName}
üìû *Tel√©fono:* ${appointment.phone}
üè† *Direcci√≥n:* ${appointment.address}
üìç *Comuna:* ${appointment.comuna}
üìÖ *Fecha:* ${formatDate(appointment.date)}
üïê *Hora:* ${formatTime(appointment.time)}
üí¨ *Motivo:* ${appointment.reason || 'No especificado'}
üîë *C√≥digo Cita:* ${appointment.accessCode}

_Cita agendada el ${new Date().toLocaleString('es-CL')}_`;

            // Mensaje para el cliente (WhatsApp)
            const messageToClient = `‚úÖ *CITA CONFIRMADA - Manada Patitas* üêæ

Hola *${appointment.ownerName}*,

Tu cita veterinaria ha sido agendada exitosamente:

üêï *Mascota:* ${appointment.petName}
üìÖ *Fecha:* ${formatDate(appointment.date)}
üïê *Hora:* ${formatTime(appointment.time)}
üè† *Direcci√≥n:* ${appointment.address}
üìç *Comuna:* ${appointment.comuna}
üí¨ *Motivo:* ${appointment.reason || 'No especificado'}

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üîë *C√ìDIGO DE TU CITA:* ${appointment.accessCode}
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

‚ö†Ô∏è *IMPORTANTE:* Guarda este c√≥digo. Lo necesitar√°s para:
‚Ä¢ Ver el estado de tu cita
‚Ä¢ Cancelar si es necesario

Nos vemos pronto. ¬°Gracias por confiar en nosotros! ü©∫`;

            // WHATSAPP PRE-ESCRITO - Enviar al veterinario
            if (config.whatsappNumber) {
                const whatsappUrl = `https://wa.me/${config.whatsappNumber}?text=${encodeURIComponent(messageToVet)}`;
                window.open(whatsappUrl, '_blank');
            }

            // WHATSAPP PRE-ESCRITO - Enviar al cliente
            if (appointment.phone) {
                const clientPhone = String(appointment.phone || '').replace(/\D/g, '');
                const whatsappClientUrl = `https://wa.me/${clientPhone}?text=${encodeURIComponent(messageToClient)}`;
                setTimeout(() => {
                    window.open(whatsappClientUrl, '_blank');
                }, 1500);
            }
        }

        // Enviar notificaci√≥n de cancelaci√≥n
        function sendCancellationNotification(appointment, cancelledBy) {
            const config = getConfig();
            
            // Preparar datos para EmailJS
            const emailData = {
                owner_name: appointment.ownerName,
                pet_name: appointment.petName,
                phone: appointment.phone,
                address: appointment.address || '',
                comuna: appointment.comuna,
                date: formatDate(appointment.date),
                time: formatTime(appointment.time),
                reason: appointment.reason || 'No especificado',
                client_email: appointment.clientEmail || '',
                access_code: appointment.accessCode
            };

            // EMAILS AUTOM√ÅTICOS con EmailJS (si est√° configurado)
            if (config.emailjs && config.emailjs.publicKey) {
                // Email al veterinario
                sendCancellationEmail(emailData, cancelledBy, 'vet');
                
                // Email al cliente (si proporcion√≥ email)
                if (appointment.clientEmail) {
                    sendCancellationEmail(emailData, cancelledBy, 'client');
                }
            }
            
            // Mensaje para el veterinario (WhatsApp)
            const messageToVet = `‚ùå *CITA CANCELADA*

üë§ *Due√±o:* ${appointment.ownerName}
üêï *Mascota:* ${appointment.petName}
üìû *Tel√©fono:* ${appointment.phone}
üìç *Comuna:* ${appointment.comuna}
üìÖ *Fecha:* ${formatDate(appointment.date)}
üïê *Hora:* ${formatTime(appointment.time)}

_Cancelada por: ${cancelledBy}_
_${new Date().toLocaleString('es-CL')}_`;

            // Mensaje para el cliente (WhatsApp)
            const messageToClient = `‚ùå *CITA CANCELADA - Manada Patitas*

Hola *${appointment.ownerName}*,

Tu cita veterinaria ha sido cancelada:

üêï *Mascota:* ${appointment.petName}
üìÖ *Fecha:* ${formatDate(appointment.date)}
üïê *Hora:* ${formatTime(appointment.time)}

Si necesitas reagendar, escr√≠benos. ¬°Gracias!`;

            // WHATSAPP PRE-ESCRITO - Enviar al veterinario
            if (config.whatsappNumber) {
                const whatsappUrl = `https://wa.me/${config.whatsappNumber}?text=${encodeURIComponent(messageToVet)}`;
                window.open(whatsappUrl, '_blank');
            }

            // WHATSAPP PRE-ESCRITO - Enviar al cliente
            if (appointment.phone) {
                const clientPhone = String(appointment.phone || '').replace(/\D/g, '');
                const whatsappClientUrl = `https://wa.me/${clientPhone}?text=${encodeURIComponent(messageToClient)}`;
                setTimeout(() => {
                    window.open(whatsappClientUrl, '_blank');
                }, 1500);
            }
        }


        // Crear URL para Google Calendar
        function createGoogleCalendarUrl(appointment) {
            const startDateTime = new Date(appointment.date + 'T' + appointment.time);
            const endDateTime = new Date(startDateTime.getTime() + 60 * 60 * 1000); // +1 hora por defecto
            
            // Formato: YYYYMMDDTHHmmss
            const formatGoogleDate = (date) => {
                return date.toISOString().replace(/-|:|\.\d{3}/g, '').slice(0, -1);
            };
            
            const title = `üêæ Visita Veterinaria - ${appointment.petName}`;
            const details = `Mascota: ${appointment.petName}
Due√±o: ${appointment.ownerName}
Tel√©fono: ${appointment.phone}
Direcci√≥n: ${appointment.address || ''}
Comuna: ${appointment.comuna}
${appointment.reason ? 'Motivo: ' + appointment.reason : ''}

Manada Patitas - Veterinaria a Domicilio`;
            
            const location = (appointment.address ? appointment.address + ', ' : '') + appointment.comuna + ', Chile';
            
            const url = `https://calendar.google.com/calendar/render?action=TEMPLATE` +
                `&text=${encodeURIComponent(title)}` +
                `&dates=${formatGoogleDate(startDateTime)}/${formatGoogleDate(endDateTime)}` +
                `&details=${encodeURIComponent(details)}` +
                `&location=${encodeURIComponent(location)}`;
            
            return url;
        }

        // Generar archivo .ics (iCalendar)
        function generateICS(appointment) {
            const startDateTime = new Date(appointment.date + 'T' + appointment.time);
            const endDateTime = new Date(startDateTime.getTime() + 60 * 60 * 1000);
            
            const formatICSDate = (date) => {
                return date.toISOString().replace(/-|:|\.\d{3}/g, '');
            };
            
            const icsContent = `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Manada Patitas//Veterinaria//ES
BEGIN:VEVENT
UID:${appointment.id}@manadapatitas.cl
DTSTAMP:${formatICSDate(new Date())}
DTSTART:${formatICSDate(startDateTime)}
DTEND:${formatICSDate(endDateTime)}
SUMMARY:üêæ Visita Veterinaria - ${appointment.petName}
DESCRIPTION:Mascota: ${appointment.petName}\\nDue√±o: ${appointment.ownerName}\\nTel√©fono: ${appointment.phone}\\nDirecci√≥n: ${appointment.address || ''}\\nComuna: ${appointment.comuna}${appointment.reason ? '\\nMotivo: ' + appointment.reason : ''}\\n\\nManada Patitas - Veterinaria a Domicilio
LOCATION:${(appointment.address ? appointment.address + ', ' : '') + appointment.comuna}, Chile
STATUS:CONFIRMED
END:VEVENT
END:VCALENDAR`;
            
            return icsContent;
        }

        // Descargar archivo .ics
        function downloadICS(appointment) {
            const icsContent = generateICS(appointment);
            const blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `cita-${appointment.petName}-${appointment.date}.ics`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Verificar c√≥digo de acceso del cliente
        function verifyAccessCode() {
            const code = document.getElementById('clientAccessCodeInput').value.trim().toUpperCase();
            
            console.log('üîç Verificando c√≥digo:', code);
            
            if (!code) {
                alert('‚ö†Ô∏è Por favor ingresa el c√≥digo de tu cita');
                return;
            }

            const appointments = (function(){try{const s=localStorage.getItem('appointments');return s&&s!=='undefined'&&s!=='null'?JSON.parse(s):[];}catch(e){return [];}})() || [];
            console.log('üìã Total de citas en localStorage:', appointments.length);
            console.log('üìã Citas:', appointments.map(a => ({code: a.accessCode, pet: a.petName})));
            
            const clientAppointments = appointments.filter(apt => apt.accessCode === code);
            console.log('‚úÖ Citas con c√≥digo', code + ':', clientAppointments.length);

            if (clientAppointments.length === 0) {
                alert('‚ùå C√≥digo no encontrado. Verifica que est√© bien escrito.');
                return;
            }

            // Guardar c√≥digo verificado
            clientAccessCode = code;
            
            // Ocultar prompt y mostrar citas
            document.getElementById('accessCodePrompt').style.display = 'none';
            document.getElementById('appointmentsList').style.display = 'block';
            document.getElementById('changeCodeBtn').style.display = 'block';
            
            // Cargar citas del cliente
            loadAppointments();
        }

        // Resetear c√≥digo de acceso
        function resetAccessCode() {
            clientAccessCode = null;
            document.getElementById('clientAccessCodeInput').value = '';
            document.getElementById('accessCodePrompt').style.display = 'block';
            document.getElementById('appointmentsList').style.display = 'none';
            document.getElementById('changeCodeBtn').style.display = 'none';
        }

        // Cargar citas
        async function loadAppointments() {
            console.log('üì• Cargando citas...');
            console.log('üîë C√≥digo del cliente:', clientAccessCode);
            console.log('üîê Es admin?', isAuthenticated);
            
            let appointments = await syncAppointmentsFromSheets();
            console.log('üìã Citas despu√©s de sync:', appointments.length);
            console.log('üìã Detalle:', appointments.map(a => ({code: a.accessCode, pet: a.petName})));
            
            const container = document.getElementById('appointmentsList');

            // Si no es admin, filtrar solo las citas con el c√≥digo del cliente
            if (!isAuthenticated && clientAccessCode) {
                appointments = appointments.filter(apt => apt.accessCode === clientAccessCode);
                console.log('‚úÖ Citas filtradas por c√≥digo:', appointments.length);
            }

            if (appointments.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-light); padding: 40px;">No tienes citas agendadas con este c√≥digo</p>';
                return;
            }

            container.innerHTML = appointments
                .sort((a, b) => new Date(a.date + ' ' + a.time) - new Date(b.date + ' ' + b.time))
                .map(apt => {
                    const statusClass = apt.status.toLowerCase().replace(' ', '');
                    const isPending = apt.status === 'Pendiente';
                    
                    return `
                    <div class="appointment-card ${statusClass}">
                        <div class="appointment-header">
                            <div class="appointment-name">üêæ ${apt.petName}</div>
                            <span class="badge ${statusClass}">${apt.status}</span>
                        </div>
                        <div class="appointment-info">
                            <strong>Due√±o:</strong> ${apt.ownerName}<br>
                            <strong>Fecha:</strong> ${formatDate(apt.date)}<br>
                            <strong>Hora:</strong> ${formatTime(apt.time)}<br>
                            <strong>Direcci√≥n:</strong> ${apt.address || 'No especificada'}<br>
                            <strong>Comuna:</strong> ${apt.comuna}<br>
                            <strong>Tel√©fono:</strong> ${apt.phone}<br>
                            ${apt.reason ? `<strong>Motivo:</strong> ${apt.reason}<br>` : ''}
                            ${isAuthenticated ? `<strong>C√≥digo:</strong> ${apt.accessCode}<br>` : ''}
                        </div>
                        
                        <div class="action-buttons" style="margin-top: 15px; border-top: 1px solid #e0e0e0; padding-top: 15px;">
                            <button class="btn-action" style="background: #4285f4; color: white;" 
                                    onclick="window.open(createGoogleCalendarUrl(${JSON.stringify(apt)}), '_blank')">
                                üìÖ Google Calendar
                            </button>
                            <button class="btn-action" style="background: #34a853; color: white;" 
                                    onclick="downloadICS(${JSON.stringify(apt)})">
                                üì• Descargar .ics
                            </button>
                        </div>
                        
                        ${isPending ? `
                        <div class="action-buttons">
                            ${isAuthenticated ? `
                                <button class="btn-action btn-complete" onclick="markAsCompleted(${apt.id})">
                                    ‚úÖ Marcar como Realizada
                                </button>
                            ` : ''}
                            <button class="btn-action btn-cancel" onclick="cancelAppointment(${apt.id}, ${isAuthenticated})">
                                ‚ùå Cancelar Cita
                            </button>
                        </div>
                        ` : ''}
                    </div>
                `;
                }).join('');
        }

        // Marcar cita como realizada (solo admin)
        async function markAsCompleted(appointmentId) {
            if (!confirm('¬øMarcar esta cita como realizada?')) return;
            
            const appointments = (function(){try{const s=localStorage.getItem('appointments');return s&&s!=='undefined'&&s!=='null'?JSON.parse(s):[];}catch(e){return [];}})() || [];
            const index = appointments.findIndex(apt => apt.id === appointmentId);
            
            if (index !== -1) {
                appointments[index].status = 'Realizada';
                localStorage.setItem('appointments', JSON.stringify(appointments));
                
                // Sincronizar con Google Sheets
                await sendToGoogleSheets('update', { appointment: appointments[index] });
                
                // Sincronizar con Sheets antes de refrescar
                await syncAppointmentsFromSheets();
                
                // Refrescar la vista apropiada
                if (isAuthenticated) {
                    await loadAdminAppointments('all');
                } else {
                    await verifyAccessCode();
                }
                
                alert('‚úÖ Cita marcada como realizada');
            }
        }

        // Cancelar cita
        async function cancelAppointment(appointmentId, isAdmin) {
            const cancelledBy = isAdmin ? 'el veterinario' : 'el cliente';
            
            if (!confirm(`¬øEst√°s seguro de cancelar esta cita?`)) return;
            
            console.log('üîÑ Iniciando cancelaci√≥n de cita:', appointmentId);
            
            const appointments = (function(){try{const s=localStorage.getItem('appointments');return s&&s!=='undefined'&&s!=='null'?JSON.parse(s):[];}catch(e){return [];}})() || [];
            const index = appointments.findIndex(apt => apt.id === appointmentId);
            
            if (index !== -1) {
                const appointment = appointments[index];
                appointments[index].status = 'Cancelada';
                localStorage.setItem('appointments', JSON.stringify(appointments));
                
                // Sincronizar con Google Sheets
                await sendToGoogleSheets('update', { appointment: appointments[index] });
                
                // Enviar notificaciones de cancelaci√≥n
                sendCancellationNotification(appointment, cancelledBy);
                
                // Sincronizar con Sheets antes de refrescar
                await syncAppointmentsFromSheets();
                
                // Refrescar la vista apropiada
                if (isAuthenticated) {
                    await loadAdminAppointments('all');
                } else {
                    await verifyAccessCode();
                }
                
                alert('‚ùå Cita cancelada. Se han enviado las notificaciones.');
            }
        }


        // ========================================
        // INICIALIZACI√ìN - Ejecutar cuando DOM est√© listo
        // ========================================
        document.addEventListener('DOMContentLoaded', function() {
        // Limpiar localStorage corrupto
        const stored = localStorage.getItem('appointments');
        if (stored === 'undefined' || stored === 'null') {
            console.log('üßπ Limpiando localStorage corrupto');
            localStorage.setItem('appointments', '[]');
        }
        
        // Configurar fecha m√≠nima (hoy)
        document.getElementById('visitDate').min = new Date().toISOString().split('T')[0];
        
        // Event listener para generar slots cuando cambia la fecha
        document.getElementById('visitDate').addEventListener('change', function() {
            const selectedDate = new Date(this.value + 'T00:00:00');
            const dayOfWeek = selectedDate.getDay();
            const config = getConfig();
            const workingDays = config.workingDays || [1, 2, 3, 4, 5];
            
            // Verificar si el d√≠a est√° habilitado
            if (!workingDays.includes(dayOfWeek)) {
                const dayNames = ['domingo', 'lunes', 'martes', 'mi√©rcoles', 'jueves', 'viernes', 's√°bado'];
                const workingDayNames = workingDays.map(d => dayNames[d]).join(', ');
                
                alert(`‚ö†Ô∏è Lo sentimos, no atendemos los ${dayNames[dayOfWeek]}s.\n\nD√≠as disponibles: ${workingDayNames}`);
                this.value = '';
                document.getElementById('timeSlots').innerHTML = '';
                return;
            }
            
            generateTimeSlots();
        });

        // Inicializar
        initConfig();
        loadComunasSelect();
        
        // Cargar Instagram link
        const config = getConfig();
        document.getElementById('instagramLink').href = config.instagram;

        // Actualizar WhatsApp en servicios
        updateContactDisplay();

        // Inicializar EmailJS si est√° configurado
        if (config.emailjs && config.emailjs.publicKey) {
            emailjs.init(config.emailjs.publicKey);
            console.log('EmailJS inicializado correctamente');
        }

        // Verificar que la configuraci√≥n tenga todos los campos necesarios
        if (!config.password) {
            config.password = 'admin123';
            saveConfig(config);
        }
        if (!config.workingDays || config.workingDays.length === 0) {
            config.workingDays = [1, 2, 3, 4, 5];
            saveConfig(config);
        }
        if (!config.emailjs) {
            config.emailjs = {
                publicKey: '',
                serviceId: '',
                templateIdAgenda: '',
                templateIdCancelacion: ''
            };
            saveConfig(config);
        }

        // Cerrar modal al hacer clic fuera
        document.getElementById('authModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeAuthModal();
            }
        });


        // Cargar logo de Manada Patitas
        const logoManadaPatitas = 'data:image/png;base64,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';
        document.getElementById('logoManadaPatitas').src = logoManadaPatitas;
        

        });
    </script>
</body>
</html>
